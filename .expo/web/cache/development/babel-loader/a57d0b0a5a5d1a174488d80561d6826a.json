{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nexport var Guard = _createClass(function Guard() {\n  _classCallCheck(this, Guard);\n});\nGuard.authenticated = false;\n\nGuard.login = function _callee(username, password) {\n  var request, res, content;\n  return _regeneratorRuntime.async(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          request = {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            credentials: 'include',\n            body: JSON.stringify({\n              username: username,\n              password: password\n            })\n          };\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(fetch('http://localhost:5000/login', request));\n\n        case 3:\n          res = _context.sent;\n\n          if (!res.ok) {\n            _context.next = 15;\n            break;\n          }\n\n          console.log('res', res.headers.get('Set-Cookie'));\n          Guard.authenticated = true;\n          _context.next = 9;\n          return _regeneratorRuntime.awrap(res.json());\n\n        case 9:\n          content = _context.sent;\n          _context.next = 12;\n          return _regeneratorRuntime.awrap(AsyncStorage.setItem('jwt', res.headers.get('Set-Cookie')));\n\n        case 12:\n          _context.next = 14;\n          return _regeneratorRuntime.awrap(AsyncStorage.setItem('uid', content.uid));\n\n        case 14:\n          return _context.abrupt(\"return\", _objectSpread({}, content.user));\n\n        case 15:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, null, Promise);\n};\n\nGuard.logout = function _callee2() {\n  var request, res;\n  return _regeneratorRuntime.async(function _callee2$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return _regeneratorRuntime.awrap(AsyncStorage.getItem('uid'));\n\n        case 2:\n          _context2.t0 = _context2.sent;\n          _context2.t1 = {\n            'uid': _context2.t0\n          };\n          request = {\n            method: 'GET',\n            headers: _context2.t1,\n            credentials: 'include'\n          };\n          _context2.prev = 5;\n          _context2.next = 8;\n          return _regeneratorRuntime.awrap(fetch('http://localhost:5000/logout', request));\n\n        case 8:\n          res = _context2.sent;\n          _context2.next = 11;\n          return _regeneratorRuntime.awrap(AsyncStorage.clear());\n\n        case 11:\n          Guard.authenticated = false;\n          _context2.next = 17;\n          break;\n\n        case 14:\n          _context2.prev = 14;\n          _context2.t2 = _context2[\"catch\"](5);\n          return _context2.abrupt(\"return\", console.log(_context2.t2));\n\n        case 17:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[5, 14]], Promise);\n};\n\nGuard.isAuthenticated = function () {\n  console.log('authenticated', Guard.authenticated);\n  return Guard.authenticated;\n};","map":{"version":3,"sources":["/home/lenovo/workspace/socialNetwork/mobile/components/Authentication/Guard.js"],"names":["AsyncStorage","Guard","authenticated","login","username","password","request","method","headers","credentials","body","JSON","stringify","fetch","res","ok","console","log","get","json","content","setItem","uid","user","logout","getItem","clear","isAuthenticated"],"mappings":";;;;;;;;;AAAA,OAAOA,YAAP,MAAyB,2CAAzB;AAEA,WAAaC,KAAb;AAAA;AAAA;AAAaA,K,CAEFC,a,GAAgB,K;;AAFdD,K,CAIFE,K,GAAQ,iBAAOC,QAAP,EAAiBC,QAAjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAELC,UAAAA,OAFK,GAEK;AACZC,YAAAA,MAAM,EAAE,MADI;AAEZC,YAAAA,OAAO,EAAE;AAAE,8BAAgB;AAAlB,aAFG;AAGZC,YAAAA,WAAW,EAAE,SAHD;AAIZC,YAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AAAER,cAAAA,QAAQ,EAARA,QAAF;AAAYC,cAAAA,QAAQ,EAARA;AAAZ,aAAf;AAJM,WAFL;AAAA;AAAA,2CASOQ,KAAK,CAAC,6BAAD,EAAgCP,OAAhC,CATZ;;AAAA;AASLQ,UAAAA,GATK;;AAAA,eAWPA,GAAG,CAACC,EAXG;AAAA;AAAA;AAAA;;AAYPC,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBH,GAAG,CAACN,OAAJ,CAAYU,GAAZ,CAAgB,YAAhB,CAAnB;AACAjB,UAAAA,KAAK,CAACC,aAAN,GAAsB,IAAtB;AAbO;AAAA,2CAceY,GAAG,CAACK,IAAJ,EAdf;;AAAA;AAcDC,UAAAA,OAdC;AAAA;AAAA,2CAeDpB,YAAY,CAACqB,OAAb,CAAqB,KAArB,EAA4BP,GAAG,CAACN,OAAJ,CAAYU,GAAZ,CAAgB,YAAhB,CAA5B,CAfC;;AAAA;AAAA;AAAA,2CAgBDlB,YAAY,CAACqB,OAAb,CAAqB,KAArB,EAA4BD,OAAO,CAACE,GAApC,CAhBC;;AAAA;AAAA,6DAiBKF,OAAO,CAACG,IAjBb;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,C;;AAJNtB,K,CAyBFuB,M,GAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2CAGgBxB,YAAY,CAACyB,OAAb,CAAqB,KAArB,CAHhB;;AAAA;AAAA;AAAA;AAGG,iBAHH;AAAA;AACNnB,UAAAA,OADM;AAERC,YAAAA,MAFQ,EAEA,KAFA;AAGRC,YAAAA,OAHQ;AAIRC,YAAAA,WAJQ,EAIK;AAJL;AAAA;AAAA;AAAA,2CAQUI,KAAK,CAAC,8BAAD,EAAiCP,OAAjC,CARf;;AAAA;AAQFQ,UAAAA,GARE;AAAA;AAAA,2CASFd,YAAY,CAAC0B,KAAb,EATE;;AAAA;AAURzB,UAAAA,KAAK,CAACC,aAAN,GAAsB,KAAtB;AAVQ;AAAA;;AAAA;AAAA;AAAA;AAAA,4CAYDc,OAAO,CAACC,GAAR,cAZC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,C;;AAzBPhB,K,CAyCF0B,e,GAAkB,YAAM;AAC3BX,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BhB,KAAK,CAACC,aAAnC;AACA,SAAOD,KAAK,CAACC,aAAb;AACH,C","sourcesContent":["import AsyncStorage from '@react-native-async-storage/async-storage';\n\nexport class Guard {\n\n    static authenticated = false\n\n    static login = async (username, password) => {\n\n        const request = {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            credentials: 'include',\n            body: JSON.stringify({ username, password })\n        }\n\n        const res = await fetch('http://localhost:5000/login', request)\n\n        if (res.ok) {\n            console.log('res', res.headers.get('Set-Cookie'))\n            Guard.authenticated = true\n            const content = await res.json()\n            await AsyncStorage.setItem('jwt', res.headers.get('Set-Cookie'))\n            await AsyncStorage.setItem('uid', content.uid)\n            return { ...content.user }\n        }\n    }\n\n    static logout = async () => {\n        const request = {\n            method: 'GET',\n            headers: { 'uid': await AsyncStorage.getItem('uid') },\n            credentials: 'include'\n        }\n\n        try {\n            const res = await fetch('http://localhost:5000/logout', request);\n            await AsyncStorage.clear()\n            Guard.authenticated = false;\n        } catch (err) {\n            return console.log(err);\n        }\n    }\n\n    static isAuthenticated = () => {\n        console.log('authenticated', Guard.authenticated)\n        return Guard.authenticated\n    }\n}"]},"metadata":{},"sourceType":"module"}